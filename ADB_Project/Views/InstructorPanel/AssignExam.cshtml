@model ADB_Project.Models.ViewModels.AssignExamVM

@{
    ViewData["Title"] = "Assign Exam";
}

<style>
    /* Add some basic styling to make it look nice */
    .assignment-form {
        max-width: 800px;
        margin: 0 auto;
    }

    .method-group {
        margin-bottom: 20px;
    }

    .selection-group {
        margin-bottom: 20px;
    }

    .student-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #dee2e6;
        padding: 15px;
        border-radius: 5px;
    }

    .search-input {
        margin-bottom: 10px;
    }
</style>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow assignment-form">
                <div class="card-header bg-warning text-dark">
                    <h4>Assign Exam to Students</h4>
                </div>
                <div class="card-body">
                    <form asp-action="AssignExam" method="post">
                        <input asp-for="ExamId" type="hidden" />

                        <!-- Assignment Method -->
                        <div class="method-group">
                            <h6>Assignment Method</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" asp-for="AssignmentMethod" id="byBranch" value="Branch" />
                                <label class="form-check-label" for="byBranch">By Branch</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" asp-for="AssignmentMethod" id="byDept" value="Dept" />
                                <label class="form-check-label" for="byDept">By Department</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" asp-for="AssignmentMethod" id="manual" value="Manual" checked />
                                <label class="form-check-label" for="manual">Manual Selection</label>
                            </div>
                        </div>

                        <!-- Branch Selection (hidden initially) -->
                        <div class="selection-group" id="branchSection" style="display: none;">
                            <label>Select Branches</label>
                            <select asp-for="SelectedBranchIds" asp-items="@Model.Branches" class="form-control" multiple>
                            </select>
                        </div>

                        <!-- Department Selection (hidden initially) -->
                        <div class="selection-group" id="deptSection" style="display: none;">
                            <label>Select Departments</label>
                            <select asp-for="SelectedDeptIds" asp-items="@Model.Departments" class="form-control" multiple>
                            </select>
                        </div>

                        <!-- Student Selection with Search -->
                        <div class="selection-group" id="studentSection">
                            <h6>Select Students</h6>
                            <input type="text" id="studentSearch" class="form-control search-input" placeholder="Search students by name..." />
                            <div class="student-list">
                                @if (Model.Students != null)
                                {
                                    foreach (var student in Model.Students)
                                    {
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="SelectedStudentIds" value="@student.Value" id="student_@student.Value" />
                                            <label class="form-check-label" for="student_@student.Value">
                                                @student.Text
                                            </label>
                                        </div>
                                    }
                                }
                                else
                                {
                                    <p>No students available.</p>
                                }
                            </div>
                        </div>

                        <!-- Due Date -->
                        <div class="form-group">
                            <label asp-for="DueDate" class="form-label fw-bold">Due Date (Optional)</label>
                            <input asp-for="DueDate" type="datetime-local" class="form-control" />
                        </div>

                        <div class="text-end mt-4">
                            <a asp-action="ExamDetails" asp-route-examId="@Model.ExamId" class="btn btn-secondary me-2">Cancel</a>
                            <button type="submit" class="btn btn-warning btn-lg">Assign Exam</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Toggle sections based on method
        document.querySelectorAll('input[name="AssignmentMethod"]').forEach(radio => {
            radio.addEventListener('change', function () {
                document.getElementById('branchSection').style.display = this.value === 'Branch' ? 'block' : 'none';
                document.getElementById('deptSection').style.display = this.value === 'Dept' ? 'block' : 'none';
                document.getElementById('studentSection').style.display = this.value === 'Manual' ? 'block' : 'none';
            });
        });

        // Student search
        const studentSearch = document.getElementById('studentSearch');
        if (studentSearch) {
            studentSearch.addEventListener('keyup', function () {
                const searchValue = this.value.toLowerCase();
                const studentChecks = document.querySelectorAll('.student-list .form-check');
                studentChecks.forEach(check => {
                    const label = check.querySelector('label').textContent.toLowerCase();
                    check.style.display = label.includes(searchValue) ? 'block' : 'none';
                });
            });
        }
    </script>
}